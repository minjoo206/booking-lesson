# ğŸ”¥ Firebase Database Setup Guide

## âœ… **What We've Fixed:**

### **1. Teacher Dashboard - Upcoming Bookings**
- âœ… **Removed mock data** - New teachers see empty bookings list
- âœ… **Firebase integration** - Loads real bookings from Firestore
- âœ… **Proper queries** - Only shows scheduled bookings for that teacher

### **2. Edit Booking Page - Save Settings**
- âœ… **Firebase saving** - All settings saved to Firestore
- âœ… **Firebase loading** - Settings loaded on page load
- âœ… **Data persistence** - Changes are saved permanently

### **3. Student Booking Page**
- âœ… **Firebase integration** - Loads teacher profile from Firestore
- âœ… **Real data** - Shows actual teacher settings, not mock data
- âœ… **Graceful fallback** - Shows message if teacher hasn't set up profile yet

## ğŸ“Š **Firebase Collections Needed:**

### **Collection 1: `users`**
This is already created! Stores basic user information.

**Document ID:** User's Firebase Auth UID

**Fields:**
```json
{
  "id": "user123",
  "email": "teacher@example.com",
  "name": "Hailey Kim",
  "role": "teacher",
  "dateOfBirth": "1990-01-15",
  "profileComplete": true,
  "createdAt": "2024-01-01T00:00:00.000Z"
}
```

### **Collection 2: `teacherSettings`** âœ¨ NEW
Stores teacher booking page customization and availability.

**Document ID:** Teacher's user ID (same as `users` collection)

**Fields:**
```json
{
  "id": "teacher123",
  "name": "Hailey Kim",
  "email": "hailey@example.com",
  "bookingPageTitle": "Hailey's Korean Lessons",
  "description": "Native Korean speaker with 5+ years of teaching experience. I specialize in conversational Korean and help students build confidence in speaking.",
  "languages": ["Korean", "English"],
  "specialties": ["Conversational Korean", "Business Korean", "TOPIK Preparation"],
  "meetingRoom": "google-meet",
  "customMeetingRoom": "",
  "customLink": "korean-lessons-hailey",
  "autoLink": "https://yoursite.com/teacher/teacher123/book",
  "useCustomLink": false,
  "classTitle": "Korean Lesson",
  "classDuration": 50,
  "availability": {
    "monday": [
      { "start": "09:00", "end": "12:00" },
      { "start": "14:00", "end": "17:00" }
    ],
    "tuesday": [
      { "start": "09:00", "end": "17:00" }
    ],
    "wednesday": [
      { "start": "09:00", "end": "17:00" }
    ],
    "thursday": [
      { "start": "09:00", "end": "17:00" }
    ],
    "friday": [
      { "start": "09:00", "end": "17:00" }
    ],
    "saturday": [],
    "sunday": []
  },
  "updatedAt": "2024-01-01T00:00:00.000Z"
}
```

**How it's created:**
- âœ… Automatically created when teacher saves their settings in Edit Booking Page
- âœ… Updated every time teacher clicks "Save Changes"

### **Collection 3: `bookings`** âœ¨ NEW
Stores all lesson bookings between students and teachers.

**Document ID:** Auto-generated by Firestore

**Fields:**
```json
{
  "id": "booking123",
  "teacherId": "teacher123",
  "studentId": "student456",
  "studentName": "John Smith",
  "studentEmail": "john@example.com",
  "date": "2024-01-15",
  "time": "10:00 AM",
  "duration": 50,
  "status": "scheduled",
  "meetLink": "https://meet.google.com/abc-defg-hij",
  "createdAt": "2024-01-01T00:00:00.000Z"
}
```

**Possible status values:**
- `"scheduled"` - Lesson is upcoming
- `"completed"` - Lesson has been completed
- `"cancelled"` - Booking was cancelled

**How it's created:**
- âœ… Created when a student books a lesson through the teacher's booking page
- âœ… Google Meet link generated automatically

### **Collection 4: `lessonBalances`**
Stores student lesson credits/balance.

**Document ID:** Student's user ID

**Fields:**
```json
{
  "studentId": "student456",
  "totalLessons": 10,
  "usedLessons": 2,
  "remainingLessons": 8,
  "lastUpdated": "2024-01-01T00:00:00.000Z"
}
```

**How it's updated:**
- âœ… Created/increased when student purchases lesson package
- âœ… Decreased when student books a lesson
- âœ… Checked before allowing bookings

## ğŸ” **Firebase Security Rules:**

You need to set up security rules for the new collections. Go to Firebase Console â†’ Firestore Database â†’ Rules:

```javascript
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    
    // Users collection - users can read/write their own data
    match /users/{userId} {
      allow read: if request.auth != null;
      allow write: if request.auth != null && request.auth.uid == userId;
    }
    
    // Teacher Settings - teachers can manage their own settings
    match /teacherSettings/{teacherId} {
      allow read: if request.auth != null;
      allow write: if request.auth != null && request.auth.uid == teacherId;
    }
    
    // Bookings - teachers see their bookings, students see theirs
    match /bookings/{bookingId} {
      allow read: if request.auth != null && (
        resource.data.teacherId == request.auth.uid ||
        resource.data.studentId == request.auth.uid
      );
      allow create: if request.auth != null;
      allow update: if request.auth != null && (
        resource.data.teacherId == request.auth.uid ||
        resource.data.studentId == request.auth.uid
      );
    }
    
    // Lesson Balances - students can read their own balance
    match /lessonBalances/{studentId} {
      allow read: if request.auth != null && request.auth.uid == studentId;
      allow write: if request.auth != null;
    }
  }
}
```

## ğŸ“ **How to Set Up in Firebase Console:**

### **Step 1: Create Indexes (IMPORTANT!)**

The bookings query needs a composite index. Go to:
**Firebase Console â†’ Firestore Database â†’ Indexes**

Click **"Add Index"** with these settings:
- **Collection ID:** `bookings`
- **Field 1:** `teacherId` (Ascending)
- **Field 2:** `status` (Ascending)
- **Field 3:** `date` (Ascending)
- **Query scope:** Collection

Click **"Create Index"** and wait for it to build (takes 1-2 minutes).

### **Step 2: Update Security Rules**

1. Go to **Firebase Console â†’ Firestore Database â†’ Rules**
2. Replace the existing rules with the rules shown above
3. Click **"Publish"**

### **Step 3: Test the Integration**

**For Teachers:**
1. Sign in as a teacher
2. Go to Edit Booking Page
3. Fill in your booking page details:
   - Title, description, languages, specialties
   - Meeting room settings
   - Class duration and availability
4. Click **"Save Changes"**
5. Check Firebase Console â†’ Firestore â†’ `teacherSettings` to see your data!

**For Students:**
1. Visit a teacher's booking link
2. You should see the teacher's real profile (not mock data)
3. If the teacher hasn't set up their profile, you'll see a message

## ğŸ¯ **What Happens Now:**

### **New Teachers:**
- âœ… **Empty booking list** - No mock data shown
- âœ… **Can edit their page** - Settings are saved to Firebase
- âœ… **Unique booking link** - Automatically generated

### **When Teacher Saves Settings:**
- âœ… **Data saved to Firestore** in `teacherSettings` collection
- âœ… **Success message** shown
- âœ… **Changes persist** across sessions

### **When Students Visit Booking Page:**
- âœ… **Load real teacher data** from Firestore
- âœ… **Show custom title, description, languages, specialties**
- âœ… **Fallback message** if teacher hasn't set up yet

### **When Student Books a Lesson:**
- âœ… **Booking saved** to `bookings` collection
- âœ… **Appears in teacher's dashboard** automatically
- âœ… **Student's lesson balance** updated

## ğŸš€ **Ready to Use:**

### **Test Flow:**

**As Teacher:**
1. Sign up as new teacher â†’ Empty dashboard âœ…
2. Click "Edit Booking Page" â†’ Customize settings
3. Save settings â†’ Check success message
4. Refresh page â†’ Settings should load back âœ…
5. Share booking link with students

**As Student:**
1. Visit teacher's booking link
2. See teacher's custom profile
3. Book a lesson
4. Check your lesson balance

## ğŸ’¡ **Benefits:**

### **No More Mock Data:**
- âœ… Clean slate for new teachers
- âœ… Real data only
- âœ… Professional appearance

### **Persistent Settings:**
- âœ… Settings saved to database
- âœ… Available across devices
- âœ… Never lose customizations

### **Real-Time Updates:**
- âœ… Bookings appear immediately
- âœ… Students see current availability
- âœ… Teachers manage real bookings

## ğŸ” **Monitoring Your Data:**

### **Firebase Console:**
Go to **Firestore Database** to see:

**`teacherSettings` collection:**
- One document per teacher
- Contains all customization settings
- Updated when teacher saves

**`bookings` collection:**
- One document per booking
- Shows all scheduled lessons
- Filtered by teacher/student ID

**`users` collection:**
- All registered users
- Teacher and student profiles
- Basic account info

## âš ï¸ **Important Notes:**

### **First Time Setup:**
1. **Create the composite index** (see Step 1 above) - REQUIRED!
2. **Update security rules** (see Step 2 above)
3. **Teachers must edit their page** to create `teacherSettings` document
4. **No manual data creation needed** - app creates everything automatically

### **If You See Errors:**
- **"Missing index"** â†’ Create the composite index (Step 1)
- **"Permission denied"** â†’ Update security rules (Step 2)
- **Empty teacher profile** â†’ Teacher needs to save settings first

## ğŸ¨ **What Data You'll See:**

### **After Teacher Saves Settings:**
```
teacherSettings/
  â””â”€â”€ teacher123/
      â”œâ”€â”€ bookingPageTitle: "Hailey's Korean Lessons"
      â”œâ”€â”€ description: "Native Korean speaker..."
      â”œâ”€â”€ languages: ["Korean", "English"]
      â”œâ”€â”€ specialties: ["Conversational Korean"]
      â”œâ”€â”€ meetingRoom: "google-meet"
      â”œâ”€â”€ availability: { monday: [...], tuesday: [...] }
      â””â”€â”€ updatedAt: Timestamp
```

### **After Student Books a Lesson:**
```
bookings/
  â””â”€â”€ auto-generated-id/
      â”œâ”€â”€ teacherId: "teacher123"
      â”œâ”€â”€ studentId: "student456"
      â”œâ”€â”€ studentName: "John Smith"
      â”œâ”€â”€ date: "2024-01-15"
      â”œâ”€â”€ time: "10:00 AM"
      â”œâ”€â”€ status: "scheduled"
      â””â”€â”€ meetLink: "https://meet.google.com/..."
```

**Perfect! Your Firebase database is now properly integrated with real data, no more mock bookings!** ğŸ‡°ğŸ‡·ğŸ’œ




